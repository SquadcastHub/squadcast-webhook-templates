name: Discord - Send Message
slug: discord-send-message
language: jsonnet
template-code: |  
  local data = root.data.resource_data;
  local type = root.event.type;
  local source = data.alert_source.short_name;

  local colors = {
    "incident.triggered":    "10027238",
    "incident.acknowledged": "14804480",
    "incident.reassigned":   "10027238",
    "incident.resolved":     "2219410",
  };
  local color = colors[type];

  local descriptions = {
    "incident.triggered":    data.description,
    "incident.acknowledged": "",
    "incident.reassigned":   "",
    "incident.resolved":     "",
  };
  local description = descriptions[type];

  {
    "username": data.assigned_to.name,

    "embeds": [
      {
        "title": data.message,
        "description": description,
        "color": color,

        "fields": [
          {"inline": true, "name": "Status", "value": data.status},
          {"inline": true, "name": "Affects", "value": data.service.name},
          {"inline": true, "name": "Started", "value": data.created_at},

          {"inline": true, "name": "Source", "value": source},
          {"inline": false, "name": "URL", "value": data.url},
        ]
      }
    ]
  }
